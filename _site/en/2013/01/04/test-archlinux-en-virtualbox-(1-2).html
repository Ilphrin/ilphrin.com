<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Meta info -->
    <meta charset="utf-8">
    <meta name="description" content="A website of an IT developer and open-source lover">
    <meta name="author" content="Kevin Pellet (Ilphrin)">
  <!-- End Meta info -->

  <!-- CSS -->
    <link rel="stylesheet" href="/css/monokai-sublime.min.css">
    <link rel="stylesheet" href="/bower_components/mermaid/dist/mermaid.css">
    <link rel="icon" href="/images/LogoV1.png"/>

    <link rel="stylesheet" type="text/css" href="/css/main.css"/>
  <!-- End CSS -->

  <title>Kevin / Ilphrin</title>
  <link rel="localization" hreflang="fr" href="/l10n/fr.json" type="application/vnd.oftn.l10n+json"/>
  <link rel="localization" hreflang="en" href="/l10n/en.json" type="application/vnd.oftn.l10n+json"/>

  <!-- Piwik code -->
    <script type="text/javascript">
      var _paq = _paq || [];
      // tracker methods like "setCustomDimension" should be called before "trackPageView"
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//ilphrin.com/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
  <!-- End Piwik Code -->
</head>

<body itemscope itemtype="http://schema.org/Blog">
  <header class="spaced">
  <div class="row">
    <object id="logo" type="image/svg+xml" data="/images/decoration/logo.svg">
    </object>
    <ul class="row">
      <li><a href="/2013/01/04/test-archlinux-en-virtualbox-(1-2).html">FR</a></li>
      <li><div class="separator"></div></li>
      <li><a href="/en/2013/01/04/test-archlinux-en-virtualbox-(1-2).html">EN</a></li>
    </ul>
  </div>
  <div>
    <ul class="row spaced">
      <li><a href="/en/">Home</a></li>
      <li><a href="/en/articles/">Articles</a></li>
      <li><a href="/CV_en.pdf">CV</a></li>
    </ul>
  </div>
</header>

        <article id="article">
  <div class="column">
    <section id="header_article" class="column center">
      <div class="hexag_container">
        <div class="hexag no_hover">
          <svg id="svgTest ArchLinux en VirtualBox ( 1/2 )" xmlns="http://www.w3.org/2000/svg" version="1.1" width="300" height="300" xmlns:xlink="http://www.w3.org/1999/xlink">
            <polygon class="hex" points="300,150 225,280 75,280 0,150 75,20 225,20"></polygon>
          </svg>
          <div class="content">
            <span>Test ArchLinux en VirtualBox ( 1/2 )</span>
            <img src="/images/header_articles/archlinux.png"/>
          </div>
        </div>
        <div>
          <h1>Test ArchLinux en VirtualBox ( 1/2 )</h1>
          <sub>04/01/13</sub>
        </div>
      </div>
    </section>
    <section id="content_article">
      <p>Récemment je me suis décidé à apprendre à utiliser et à comprendre le fonctionnement de Linux. Du coup j’ai voulu me tourner vers une distribution qui m’offrirait cette possibilité dès son installation. Je me suis rapidement laissé dire que ArchLinux conviendrait à mes besoins. Mais comme mon laptop ne possède pas une capacité de stockage extraordinaire (20 Go…) je l’ai mis sur un disque dur externe sous virtualbox. En lui accordant une place de 20Go, ce qui devrait largement suffire étant donné que je ne vais rien installer de superflu sur cette machine virtuelle. Je me suis aussi dit que ça pourrait en intéresser quelques-uns si je décrivais tout ce que j’avais fait dans un article. Néanmoins il y a trop de choses à faire, et je serais obligé de découper cet article en deux (sinon ça fait quand même un peu gros et lourd à la fin…)
<!--break-->
Voilà la majorité des sites sur lesquels je me suis basé pour cette installation:</p>

<ul>
  <li><a href="http://mintic.blog4ever.com/wiki.archlinux.fr/Installation">Wiki Archlinux</a>  &lt;– Surtout celui-ci, en fait cet article ne fera que détailler cette page la plupart du temps</li>
  <li><a href="http://mintic.blog4ever.com/wiki.archlinux.fr/Xorg">Wiki ArchLinux - Xorg</a>  &lt;– Pour la suite (la deuxième partie de l’article)</li>
  <li><a href="https://wiki.archlinux.org/index.php/VirtualBox#Arch_Linux_guests">ArchLinux Virtualbox</a> &lt;– Les additions invités de virtualbox</li>
</ul>

<p>Pour cet exemple j’ai téléchargé le dernier iso d’ArchLinux 32bits et j’ai suivi les étapes sur le wiki pour le mettre sur une clé USB bootable.</p>

<p>Pour tous les fichier à créer/éditer, j’utilise le logiciel nano, qui est mon préferé quand il s’agit de s’occuper des fichiers en ligne de commande.</p>

<h2 id="installation">Installation</h2>

<p>On lance la machine virtuelle (je ne décris pas ici la création d’une machine virtuelle, normalement une rapide recherche sur le net vous permet d’en savoir largement sur l’utilisation de Virtualbox).</p>

<p>Au démarrage on appuie sur F12 pour sélectionner un démarrage précis (j’ai eu un moment de doute et je ne sais plus si j’ai démarré sur floppy ou sur CD/DVD désolé…)</p>

<p>Ensuite normalement arrive le menu de démarrage Live. On prend : BOOT ArchLinux
Là on à un défilement de message incompréhensibles… Puis on arrive sur une invite de commande connecté sous root.
Commencez par mettre un clavier français:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>loadkeys fr-pc
</code></pre>
</div>

<h2 id="partitionnement">Partitionnement</h2>

<p>D’après ArchlinuxFR on devrait faire 4 partitions, mais j’omets celle correspondante au swap, ce qui m’en fait seulement 3.</p>

<p>Partitionemement grâce à fdisk avec:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>fdisk /dev/sda
</code></pre>
</div>

<p>Faites ensuite comme je l’ai fait (avec vos valeur pour la taille des différentes partitions si vous en avez fais des différentes):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Command(m for help) : n              
Parition type:                                
p  primary                                  
e  extended                                
Select(default p): p                       
Partition number(1-4, default1): 1
First sector (default 2048): 2048  
End sector: +100M                      
</code></pre>
</div>

<p>Puis par le même procédé on entre pour chacune des partitions:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>p              
2              
206848    
+12288M             (12Go)

p              
3              
25372672
(laisser vide pour prendre toute la place restante)
Command(m for help): w  (Pour quitter et enregistrer les modifications)
</code></pre>
</div>

<h2 id="formatage">Formatage</h2>

<p>On devrait donc avoir maintenant nos 3 partitions, on va les formater pour qu’elle soient en ext4 (sauf /dev/sda1 qu’on mettra en ext2). Donc pour formater tout ça on va faire :</p>

<p>mkfs.ext2 /dev/sda1 
mkfs.ext4 /dev/sda2 
mkfs.ext4 /dev/sda3</p>

<p>Attendre que chacune des commandes se termine avant de faire quoi que ce soit/passer à la suivante.</p>

<h2 id="montage-des-partitions">Montage des partitions</h2>

<p>On monte maintenant toutes les partitions pour qu’elles correspondent au dossier que l’on veut, c’est-à-dire:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mount /dev/sda2 /mnt                  # Racine
mkdir /mnt/{boot,home}              # Création des deux répertoires pour les points de montages restants
mount /dev/sda1 /mnt/boot          # Répertoire de boot
mount /dev/sda3 /mnt/home        # Répertoire perso
</code></pre>
</div>

<p>Au final au devrait donc avoir des partitions ressemblant à ça:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/home : ~8Go --&gt; /dev/sda3        ext4 Monté dans /mnt/home
/ : 12Go --&gt; /dev/sda2                 ext4 Monté dans /mnt   
/boot: 100Mo --&gt; /dev/sda1         ext2 Monté dans /mnt/boot  
</code></pre>
</div>

<h2 id="connexion-rseau">Connexion réseau</h2>

<p>Normalement si on est en connexion filiairele pc est automatiquement connecté au réseau. Cependant étant donné que nous sommes sous une machine Virtualbox ce n’est pas toujours le cas.
Il faut lancer la commande suivante afin de démarrer le démon qui gère la connexion filiaire au réseau eth0:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dhcpd etho0         (A lancer avec "sh" et non "bash" !) 
</code></pre>
</div>

<h2 id="installation-du-systme-de-base">Installation du système de base</h2>

<p>On peut changer le fichier /etc/pacman.d/mirrorlist pour obtenir le miroir le plus proche mais ce n’est pas obligatoire. Donc on va lancer l’installation
directement même si ça prend un peu plus de temps. On fait ça grâce à la commande:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pacstrap /mnt base
</code></pre>
</div>

<p>Là il faut laisser faire quelques minutes/heures selon votre connexion. Il se peut qu’il y ait une demande de confirmation de la part de l’utilisateur.</p>

<p>Ensuite il faut installer base-devel pour l’utilisation des dépôts d’utilisateur d’Arch avec la commande;</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pacstrap /mnt base-devel
</code></pre>
</div>

<p>Là aussi il faut attendre quelques minutes que le téléchargement/installation se fasse, j’ai eu droit à une demande de confirmation qui s’est…confirmée toute seul O_ô. Bon passons l’éponge pour cette fois-ci…</p>

<p>Enfin, pour terminer avec ces installations dans tous les sens, il faut installer le chargeur de démarrage. La plupart du temps on choisit GRUB ou LILO, mais la documentation se base sur l’installation de syslinux. On va donc suivre leur exemple avec:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pacstrap /mnt syslinux
</code></pre>
</div>

<p>L’installation devrait être beaucoup plus rapide. Et bien entendu…une auto-confirmation de la part de pacstrap! Faudrait que je pose la question sur les forums quand même.</p>

<h2 id="configuration">Configuration</h2>

<p>Il faut générer un fichier de configuration /etc/fstab. Il contiendra toutes les informations concernant le partitionnement du/des disque(s) et leur arborescence.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab
</code></pre>
</div>

<p>Je ne suis pas sûr de la signification des paramètres envoyés à genfstab (-U  et -p). Vous pouvez lancer un genfstab -h pour voir leur signification si vous arrivez à mieux comprendre que moi ^^”
Le symbole de flux » permet d’enregistrer la sortie de la commande dans un fichier spécifié (ici /mnt/etc/fstab,  il y aura donc un fichier nommé fstab avec comme contenu la sortie de la commande à gauche du symbole de flux). Si le fichier existe déjà le contenu sera ajouté à la fin.</p>

<p>Ensuite on va démarrer dans un nouveau système, on appelle cela Chrooter. On utilise la commande suivante:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>arch-chroot /mnt
</code></pre>
</div>

<p>On démarre un nouveau système avec comme racine l’argument spécifié après la commande arch-chroot. De ce fait on “enferme” un système dans un autre, le premier n’ayant donc plus accès aux dossiers supérieurs (on peut pas aller au-dessus de la racine /).</p>

<p>Donc ici on démarre un nouveau système dans /mnt qui contient tout ce dont on a besoin pour la suite de la configuration (puisque le(s) disque(s) et leur(s) partitions sont dans ce dossier).</p>

<p>On va ensuite donner un nom à la machine. Pour cela on va modifier le fichier /etc/hostname avec par exemple la commande nano (voir la documentation pour l’utilisation de cet outil). A ma connaissance on peut donner celui que l’on veut.</p>

<p>Le fichier étant vide, et vu qu’il n’y a aucune information spécifique sur le wiki d’ArchLinux, j’en déduis qu’il suffit simplement d’écrire le nom que l’on veut. Pour ma part je me contente d’un “archiso”.</p>

<p>Ensuite petite modification du fichier /etc/locale.gen pour définir la langue du système à utiliser et sous quel format. Pour le choisir il faut dé-commenter (enlever le #) la ligne que l’on veut. J’ai enlevé celui de la ligne “fr_FR.UTF-8 UTF-8”. Puis on lance la commande “locale-gen” pour enregistrer ce paramètre et générer le locale correspondant.
Puis on créé le fichier /etc/locale.conf et on y met:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>LANG="fr_FR.UTF-8"
</code></pre>
</div>

<p>Pour que le paramètre soit celui enregistré par défaut. Il se peut que ce paramètre ne soit pris en compte qu’au redémarrage de la machine. Pour le faire pour la session courante on lance la commande:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>export LANG=fr_FR.UTF-8
</code></pre>
</div>

<p>On édite ensuite le fichier /etc/vconsole.conf pour la configuration du type de clavier et l’on y met:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>KEYMAP=fr-pc
</code></pre>
</div>

<p>On règle maintenant l’heure locale avec un lien à /etc/localtime vers le fuseau horaire correspondant. Ici:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ln -s /usr/share/zoneinfo/Europe/Paris /etc/localtime
</code></pre>
</div>

<p>Si le votre est différent, je vous conseille de fouiller le répertoire zoneinfo pour y trouver le votre.</p>

<p>On va ensuite créer les ramdisks. Ne me demandez pas une définition je ne sais pas encore exactement ce que c’est, simplement qu’il sert pour l’image du noyau linux.
On configure ensuite le chargeur de démarrage pour qu’il…démarre x) Plus exactement on lance l’installation automatique sur le MBR (Master Boot Record) :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>syslinux-install_update -iam
</code></pre>
</div>

<p>Ça devrait se faire assez rapidement en théorie.<br />
Allez on à presque terminé! Maintenant on va définir un mot de passe pour le compte root avec la commande “passwd” (sans les guillemets”), et l’on entre ensuite le mot de passe que l’on veut (Deux fois pour vérification).
Pour finir, on va démonter toutes les partitions avec un :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>umount /mnt/boot /mnt/home /mnt
</code></pre>
</div>

<p>Vous pouvez maintenant redémarrer/éteindre votre ordinateur (virtuel) en toute tranquillité!</p>

<p>Et voilà on à terminé! Terminé? En fait pas exactement, mais ceci est la fin de la première partie de cet article. Vous pouvez continuer par-vous même par le biais du site ArchLinux. Notamment pour la création d’un utilisateur dont je ne donnerais pas d’explication ici.
Dans la deuxième partie je m’occuperais de l’installation du serveur Xorg et d’un environnement graphique.</p>

<p>Merci d’avoir pris le temps de lire cet article,  n’hésitez pas à me dire si vous avez des problème ou des suggestions. Sur ce je vous dis à bientôt et bonne fin de journée!</p>

    </section>
    <section id="comments" class="column center">

    </section>
  </div>
</article>

  <aside>
  <ul class="column">
    <li><a href="https://github.com/Ilphrin"><img class="ui mini image" src="/images/icons/github.png"/></a></li>
    <li><a href="https://diaspora-fr.org/people/30b7e950ca4c01315a827b9da7d7bc36"><img class="ui mini image" src="/images/icons/diaspora.png"/></a></li>
    <li><a href="https://twitter.com/Kilphrin"><img class="ui mini image" src="/images/icons/twitter.svg"/></a></li>
    <li><a href="https://www.linkedin.com/public-profile/settings?trk=d_flagship3_profile_self_view_public_profile"><img class="ui mini image" src="/images/icons/linkedin-icon.png"/></a></li>
  </ul>
</aside>

<footer class="spaced row">
  <p>Site and content under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Licence Creative Commons BY-NC-SA</a></p>
  <p>Optimized for Firefox</p>
</footer>



  <script type="text/javascript" src="/js/analytics.js"></script>
  <!-- Piwik -->
  <noscript><p><img src="//ilphrin.com/analytics/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
  <!-- End Piwik Code -->
  <script src="/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="/bower_components/mermaid/dist/mermaid.min.js" charset="utf-8"></script>
  <script defer>mermaid.initialize({startOnLoad:true});</script>
  <script src="/bower_components/jquery/dist/jquery.min.js" charset="utf-8"></script>

  <script defer src="/js/svg.min.js" charset="utf-8"></script>
  <script defer src="/js/main.js" charset="utf-8"></script>

</body>
</html>
